<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>storefrontapp documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css" media="(prefers-color-scheme: dark)">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">storefrontapp documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  StrategyRequestContext</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>projects/storefrontapp-e2e-cypress/cypress/helpers/vendor/cds/merchandising-carousel.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#category" 
>
                                            category
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#containsConsentReference" 
>
                                            containsConsentReference
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#facets" 
>
                                            facets
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#language" 
>
                                            language
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#productIds" 
>
                                            productIds
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="category"></a>
                                        <span class="name "><b>category</b>
                                            <a href="#category">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>category:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="containsConsentReference"></a>
                                        <span class="name "><b>containsConsentReference</b>
                                            <a href="#containsConsentReference">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>containsConsentReference:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="facets"></a>
                                        <span class="name "><b>facets</b>
                                            <a href="#facets">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>facets:     <code>string[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string[]</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="language"></a>
                                        <span class="name "><b>language</b>
                                            <a href="#language">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>language:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="productIds"></a>
                                        <span class="name "><b>productIds</b>
                                            <a href="#productIds">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>productIds:     <code>string[]</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string[]</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  CURRENCY_USD,
  LANGUAGE_EN,
} from &#x27;../../../helpers/site-context-selector&#x27;;
import {
  waitForCategoryPage,
  waitForPage,
  waitForProductPage,
} from &#x27;../../checkout-flow&#x27;;

interface StrategyRequestContext {
  language?: string;
  category?: string;
  productIds?: string[];
  facets?: string[];
  containsConsentReference?: boolean;
}

const site &#x3D; &#x27;electronics-spa&#x27;;
export const DEFAULT_LANGUAGE &#x3D; LANGUAGE_EN;
export const DEFAULT_CURRENCY &#x3D; CURRENCY_USD;
const productDisplayCount &#x3D; 10;

export const japaneseLanguage &#x3D; &#x27;ja&#x27;;
export const englishFilmProductText &#x3D; &#x27;Film&#x27;;
export const japaneseFilmProductText &#x3D; &#x27;プ&#x27;;
export const dollarCurrencySymbol &#x3D; &#x27;$&#x27;;
export const yenCurrencySymbol &#x3D; &#x27;¥&#x27;;
export const canonBrandName &#x3D; &#x27;Canon&#x27;;
export const canonBrandCode &#x3D; &#x27;brand_10&#x27;;
export const canonBrandPagePath &#x3D; &#x60;Brands/${canonBrandName}/c/${canonBrandCode}&#x60;;
export const chibaStoreName &#x3D; &#x27;Chiba&#x27;;
export const filmCamerasCategoryName &#x3D; &#x27;Film Cameras&#x27;;
export const filmCamerasCategoryCode &#x3D; &#x27;574&#x27;;
export const filmCamerasCategoryPagePath &#x3D; &#x60;Open-Catalogue/Cameras/Film-Cameras/c/${filmCamerasCategoryCode}&#x60;;
export const camcordersCategoryName &#x3D; &#x27;Camcorders&#x27;;
export const camcordersCategoryCode &#x3D; &#x27;584&#x27;;
export const slrCategoryCode &#x3D; &#x27;578&#x27;;
export const slrNonProductListCategoryPagePath &#x3D; &#x60;Open-Catalogue/Cameras/Digital-Cameras/Digital-SLR/c/${slrCategoryCode}&#x60;;
export const requestContainsConsentReference &#x3D; true;
export const checkForCarouselClickEvent &#x3D; true;

const merchandisingCarouselTagName &#x3D; &#x27;cx-merchandising-carousel&#x27;;
const carouselViewedEventSchema &#x3D; &#x27;context/commerce/carouselViewed&#x27;;
const carouselClickedEventSchema &#x3D; &#x27;context/commerce/carouselClicked&#x27;;
export const carouselEventRequestAlias &#x3D; &#x27;carouselEventApiRequest&#x27;;

/*
 * NOTE: Ids of actual products in the storefront need to be returned by the stub CDS strategy service
 * response as the products need to be retrieved from the spartacus product service
 */
export const STRATEGY_RESPONSE &#x3D; {
  metadata: {
    mixcardId: &#x27;cypress-test-mixcard&#x27;,
  },
  products: [
    {
      id: &#x27;779864&#x27;,
      metadata: {
        &#x27;cypress-test-product-metadata&#x27;: &#x27;product-1-metadata-value&#x27;,
      },
    },
    {
      id: &#x27;832382&#x27;,
      metadata: {
        &#x27;cypress-test-product-metadata&#x27;: &#x27;product-2-metadata-value&#x27;,
      },
    },
    {
      id: &#x27;779866&#x27;,
      metadata: {
        &#x27;cypress-test-product-metadata&#x27;: &#x27;product-3-metadata-value&#x27;,
      },
    },
  ],
};

function verifyCarouselLevelMetadata(
  $merchandisingCarousel: JQuery&lt;HTMLElement&gt;
): void {
  cy.wrap($merchandisingCarousel).within(() &#x3D;&gt; {
    cy.get(&#x27;.data-cx-merchandising-carousel&#x27;).should(
      ($merchandisingCarouselMetadata) &#x3D;&gt; {
        expect($merchandisingCarouselMetadata)
          .to.have.attr(&#x27;data-cx-merchandising-carousel-slots&#x27;)
          .equal(STRATEGY_RESPONSE.products.length.toString());
        expect($merchandisingCarouselMetadata)
          .to.have.attr(&#x27;data-cx-merchandising-carousel-mixcardid&#x27;)
          .equal(STRATEGY_RESPONSE.metadata.mixcardId);
      }
    );
  });
}

function verifyCarouselItemRendered(
  $carouselItem: JQuery&lt;HTMLElement&gt;,
  index: number
): void {
  const product &#x3D; STRATEGY_RESPONSE.products[index];

  cy.wrap($carouselItem).within(() &#x3D;&gt; {
    cy.get(&#x27;.data-cx-merchandising-product&#x27;).should(($productMetadata) &#x3D;&gt; {
      expect($productMetadata)
        .to.have.attr(&#x27;data-cx-merchandising-product-slot&#x27;)
        .equal((index + 1).toString());
      expect($productMetadata)
        .to.have.attr(&#x27;data-cx-merchandising-product-id&#x27;)
        .equal(product.id);
      expect($productMetadata)
        .to.have.attr(
          &#x27;data-cx-merchandising-product-cypress-test-product-metadata&#x27;
        )
        .equal(product.metadata[&#x27;cypress-test-product-metadata&#x27;]);
    });

    cy.get(&#x27;a&#x27;).within(() &#x3D;&gt; {
      cy.root().should(&#x27;have.attr&#x27;, &#x27;href&#x27;);
      cy.get(&#x27;h4&#x27;).should(&#x27;not.be.empty&#x27;);
      cy.get(&#x27;.price&#x27;).should(&#x27;not.be.empty&#x27;);
    });
  });
}

function verifyCarouselItemsRendered(
  $merchandisingCarousel: JQuery&lt;HTMLElement&gt;
): void {
  cy.wrap($merchandisingCarousel)
    .get(&#x27;.item&#x27;)
    .should(&#x27;have.length&#x27;, STRATEGY_RESPONSE.products.length)
    .each(($carouselItem, index) &#x3D;&gt; {
      verifyCarouselItemRendered($carouselItem, index);
    });
}

function verifyMerchandisingCarouselRendersProducts(): void {
  cy.get(merchandisingCarouselTagName)
    /*
     * There could be multiple merchandising carousels on the page being used to test them,
     * but as we are stubbing the product retrieval response all of them will show the same products.
     * Limit our tests to the first carousel on the page by using first() and then within()
     */
    .first()
    .should(&#x27;be.visible&#x27;)
    .within(($merchandisingCarousel) &#x3D;&gt; {
      verifyCarouselLevelMetadata($merchandisingCarousel);
      verifyCarouselItemsRendered($merchandisingCarousel);
      return cy.wrap($merchandisingCarousel);
    })
    /*
     * If we scroll immediately (i.e. before checking for the carousel item DOM elements) then sometimes
     * the carousel item observable has not finished emitting with the full product details, so not all of the products may be rendered.
     * This will then cause a view event to be sent without all the product skus, which then makes the tests flakey.
     * If we check the DOM for the carousel is as we expect first and then scroll it into view we get more reilable behaviour
     */
    .scrollIntoView({ offset: { top: 50, left: 50 } })
    .should(&#x27;be.visible&#x27;);
}

function verifyCarouselEvent(carouselEvent: any) {
  expect(carouselEvent[&#x27;strategyId&#x27;]).to.be.ok;
  expect(carouselEvent[&#x27;carouselId&#x27;]).to.be.ok;
  expect(carouselEvent[&#x27;carouselName&#x27;]).to.be.ok;
  expect(carouselEvent[&#x27;mixCardId&#x27;]).to.equal(
    STRATEGY_RESPONSE.metadata.mixcardId
  );
}

function verifyCarouselViewEvent(carouselEvent: any) {
  verifyCarouselEvent(carouselEvent);
  const expectedProductSkus &#x3D; STRATEGY_RESPONSE.products.map(
    (product) &#x3D;&gt; product.id
  );
  expect(carouselEvent[&#x27;productSkus&#x27;]).to.have.members(expectedProductSkus);
}

function verifyCarouselClickEvent(productSku: string, carouselEvent: any) {
  verifyCarouselEvent(carouselEvent);
  expect(carouselEvent[&#x27;imageUrl&#x27;]).to.be.ok;
  expect(carouselEvent[&#x27;sku&#x27;]).to.equal(productSku);
}

export function verifyRequestToStrategyService(
  requestAlias: string,
  strategyRequestContext: StrategyRequestContext
): void {
  cy.wait(&#x60;@${requestAlias}&#x60;).its(&#x27;response.statusCode&#x27;).should(&#x27;eq&#x27;, 200);

  cy.get&lt;Cypress.WaitXHR&gt;(&#x60;@${requestAlias}&#x60;).then(({ request }: any) &#x3D;&gt; {
    expect(request.url).to.contain(&#x60;site&#x3D;${site}&#x60;);
    expect(request.url).to.contain(
      &#x60;language&#x3D;${
        strategyRequestContext.language
          ? strategyRequestContext.language
          : DEFAULT_LANGUAGE
      }&#x60;
    );
    expect(request.url).to.contain(&#x60;pageSize&#x3D;${productDisplayCount}&#x60;);

    if (strategyRequestContext.category) {
      expect(request.url).to.contain(
        &#x60;category&#x3D;${strategyRequestContext.category}&#x60;
      );
    } else {
      expect(request.url).not.to.contain(&#x27;category&#x3D;&#x27;);
    }

    if (strategyRequestContext.productIds) {
      expect(request.url).to.contain(
        &#x60;products&#x3D;${strategyRequestContext.productIds}&#x60;
      );
    } else {
      expect(request.url).not.to.contain(&#x27;products&#x3D;&#x27;);
    }

    if (strategyRequestContext.facets) {
      expect(request.url).to.contain(
        &#x60;facets&#x3D;${strategyRequestContext.facets.join(&#x27;:&#x27;)}&#x60;
      );
    } else {
      expect(request.url).not.to.contain(&#x27;facets&#x3D;&#x27;);
    }

    strategyRequestContext.containsConsentReference
      ? expect(request.headers).to.have.property(&#x27;consent-reference&#x27;)
      : expect(request.headers).to.not.have.property(&#x27;consent-reference&#x27;);
  });
}

export function verifyMerchandisingCarouselRendersOnHomePage(
  strategyRequestAlias: string,
  language?: string,
  containsConsentReference?: boolean
): void {
  verifyRequestToStrategyService(strategyRequestAlias, {
    language,
    containsConsentReference,
  });

  verifyMerchandisingCarouselRendersProducts();
}

export function verifyMerchandisingCarouselRendersOnCategoryPage(
  strategyRequestAlias: string,
  categoryCode: string,
  language?: string,
  additionalFacets?: string[],
  containsConsentReference?: boolean
): void {
  verifyRequestToStrategyService(strategyRequestAlias, {
    language,
    category: categoryCode,
    facets: additionalFacets,
    containsConsentReference,
  });

  verifyMerchandisingCarouselRendersProducts();
}

export function verifyMerchandisingCarouselRendersOnBrandPage(
  strategyRequestAlias: string,
  brandCode: string,
  language?: string,
  additionalFacets?: string[]
): void {
  verifyRequestToStrategyService(strategyRequestAlias, {
    language,
    category: brandCode,
    facets: additionalFacets,
  });

  verifyMerchandisingCarouselRendersProducts();
}

export function verifyMerchandisingCarouselRendersOnPDPPage(
  strategyRequestAlias: string,
  productId: string,
  language?: string
): void {
  const strategyRequestContext: StrategyRequestContext &#x3D; {
    language,
  };
  if (productId) {
    strategyRequestContext.productIds &#x3D; [productId];
  }

  verifyRequestToStrategyService(strategyRequestAlias, strategyRequestContext);

  verifyMerchandisingCarouselRendersProducts();
}

export function applyFacet(facetGroup: string, facetName: string): void {
  cy.get(&#x27;cx-facet .heading&#x27;)
    .contains(facetGroup)
    .parents(&#x27;cx-facet&#x27;)
    .within(() &#x3D;&gt; {
      cy.get(&#x27;a.value&#x27;).contains(facetName).click();
    });
}

export function verifyFirstCarouselItemTextContent(
  toContain: string,
  toNotContain: string
): void {
  cy.get(&#x60;${merchandisingCarouselTagName} .item h4&#x60;)
    .first()
    .should(&#x27;contain.text&#x27;, toContain)
    .and(&#x27;not.contain.text&#x27;, toNotContain);
}

export function verifyFirstCarouselItemPrice(currencySymbol: string): void {
  cy.get(&#x60;${merchandisingCarouselTagName} .item .price&#x60;)
    .first()
    .should(&#x27;be.visible&#x27;)
    .and(&#x27;contain.text&#x27;, currencySymbol);
}

export function clickOnCarouselItem(
  productId: string,
  checkForCarouselEvent?: boolean
): void {
  cy.get(
    &#x60;.data-cx-merchandising-product[data-cx-merchandising-product-id&#x3D;&#x27;${productId}&#x27;&#x60;
  )
    .parent()
    .within(() &#x3D;&gt; {
      cy.root().should(&#x27;be.visible&#x27;);
      const productPage &#x3D; waitForProductPage(productId, &#x27;getProductPage&#x27;);
      cy.get(&#x27;a&#x27;).click();
      cy.wait(&#x60;@${productPage}&#x60;).its(&#x27;response.statusCode&#x27;).should(&#x27;eq&#x27;, 200);
    });

  if (checkForCarouselEvent) {
    cy.waitForCarouselEvent(carouselClickedEventSchema).should((sentEvent) &#x3D;&gt; {
      verifyCarouselClickEvent(productId, sentEvent);
    });
  }
}

export function navigateToHomepage(): void {
  const homePage &#x3D; waitForPage(&#x27;homepage&#x27;, &#x27;getHomePage&#x27;);
  cy.get(&#x27;cx-page-slot.SiteLogo&#x27;).click();
  cy.wait(&#x60;@${homePage}&#x60;).its(&#x27;response.statusCode&#x27;).should(&#x27;eq&#x27;, 200);
}

export function navigateToCategory(
  categoryName: string,
  categoryCode: string
): void {
  const categoryPage &#x3D; waitForCategoryPage(categoryCode, &#x27;getCategory&#x27;);
  cy.get(&#x27;cx-category-navigation cx-generic-link a&#x27;)
    .contains(categoryName)
    .click({ force: true });
  cy.wait(&#x60;@${categoryPage}&#x60;).its(&#x27;response.statusCode&#x27;).should(&#x27;eq&#x27;, 200);
}

export function waitForCarouselViewEvent(): void {
  cy.waitForCarouselEvent(carouselViewedEventSchema).should((sentEvent) &#x3D;&gt; {
    verifyCarouselViewEvent(sentEvent);
  });
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'StrategyRequestContext.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       
       <script type="module" src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
